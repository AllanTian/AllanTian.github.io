I"¼y<p>æœ¬ç¯‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Bootstrap File Inputï¼ˆæœ€å¥½ç”¨çš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼‰æ¥è¿›è¡Œå›¾ç‰‡çš„å±•ç¤ºã€ä¸Šä¼ ï¼Œä»¥åŠå¦‚ä½•åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œæ–‡ä»¶ä¿å­˜ã€‚</p>

<!--more-->
<h3 id="ä¸€å…ˆæ¥çœ‹æ•ˆæœå›¾å§">ä¸€ã€å…ˆæ¥çœ‹æ•ˆæœå›¾å§</h3>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTUxMDA3MTYwMTI4MzIy?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTUxMDA3MTYwMTM2ODU5?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" />
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTUxMDA3MTYxMDQzOTMz?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<h3 id="äºŒå¼•å…¥æ’ä»¶çš„æ ·å¼å’Œè„šæœ¬">äºŒã€å¼•å…¥æ’ä»¶çš„æ ·å¼å’Œè„šæœ¬</h3>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"${ctx}/components/fileinput/css/fileinput.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"${ctx}/components/fileinput/js/fileinput.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"${ctx}/components/fileinput/js/fileinput_locale_zh.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p><a href="http://plugins.krajee.com/file-input">http://plugins.krajee.com/file-input</a>,è¿™æ˜¯å…¶å®˜æ–¹æ–‡æ¡£ï¼Œé‡Œé¢æœ‰ä¸‹è½½åœ°å€ã€‚</p>

<h3 id="ä¸‰åœ¨é¡µé¢ä¸Šæ·»åŠ ç»„ä»¶">ä¸‰ã€åœ¨é¡µé¢ä¸Šæ·»åŠ ç»„ä»¶</h3>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">class=</span><span class="s">"projectfile"</span> <span class="na">value=</span><span class="s">"${deal.image}"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<ol>
  <li>type=fileå’Œclass=projectfileï¼ŒæŒ‡æ˜å…¶ä¸ºinput fileç±»å‹ã€‚</li>
  <li>nameæŒ‡å®šå…¶åœ¨åå°çš„è·å–keyã€‚</li>
  <li>valueæŒ‡å®šå…¶åœ¨å±•ç¤ºçš„æ—¶å€™å›¾ç‰‡è·¯å¾„ã€‚</li>
</ol>

<h3 id="å››åˆå§‹åŒ–">å››ã€åˆå§‹åŒ–</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">projectfileoptions</span> <span class="p">:</span> <span class="p">{</span>
		<span class="nl">showUpload</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">showRemove</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">language</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">zh</span><span class="dl">'</span><span class="p">,</span>
		<span class="nx">allowedPreviewTypes</span> <span class="p">:</span> <span class="p">[</span> <span class="dl">'</span><span class="s1">image</span><span class="dl">'</span> <span class="p">],</span>
		<span class="nx">allowedFileExtensions</span> <span class="p">:</span> <span class="p">[</span> <span class="dl">'</span><span class="s1">jpg</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">png</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">gif</span><span class="dl">'</span> <span class="p">],</span>
		<span class="nx">maxFileSize</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="c1">// æ–‡ä»¶ä¸Šä¼ æ¡†</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[class=projectfile]</span><span class="dl">'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">imageurl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">"</span><span class="s2">value</span><span class="dl">"</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">imageurl</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
			<span class="na">initialPreview</span> <span class="p">:</span> <span class="p">[</span> <span class="c1">// é¢„è§ˆå›¾ç‰‡çš„è®¾ç½®</span>
			<span class="dl">"</span><span class="s2">&lt;img src='</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">imageurl</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">' class='file-preview-image'&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">]</span>
		<span class="p">},</span> <span class="nx">projectfileoptions</span><span class="p">);</span>

		<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fileinput</span><span class="p">(</span><span class="nx">op</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fileinput</span><span class="p">(</span><span class="nx">projectfileoptions</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<ol>
  <li>é€šè¿‡jqueryè·å–å¯¹åº”çš„input fileï¼Œç„¶åæ‰§è¡Œfileinputæ–¹æ³•ã€‚</li>
  <li>showUpload è®¾ç½®æ˜¯å¦æœ‰ä¸Šä¼ æŒ‰é’®ã€‚</li>
  <li>languageæŒ‡å®šæ±‰åŒ–
<strong>4. allowedFileTypes ã€allowedFileExtensions ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰èµ·åˆ°æ•ˆæœï¼Ÿ</strong></li>
  <li>maxFileSize æŒ‡å®šä¸Šä¼ æ–‡ä»¶å¤§å°</li>
</ol>

<h3 id="äº”å¸¦fileæ–‡ä»¶çš„formè¡¨å•é€šè¿‡ajaxæäº¤">äº”ã€å¸¦fileæ–‡ä»¶çš„formè¡¨å•é€šè¿‡ajaxæäº¤</h3>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹å¸¦fileçš„formè¡¨å•å¸ƒå±€ã€‚</p>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-horizontal required-validate"</span> <span class="na">action=</span><span class="s">"${ctx}/save?callbackType=confirmTimeoutForward"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">onsubmit=</span><span class="s">"return iframeCallback(this, pageAjaxDone)"</span><span class="nt">&gt;</span>

	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">""</span> <span class="na">class=</span><span class="s">"col-md-1 control-label"</span><span class="nt">&gt;</span>é¡¹ç›®å°é¢<span class="nt">&lt;/label&gt;</span>
		<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-10 tl th"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"image"</span> <span class="na">class=</span><span class="s">"projectfile"</span> <span class="na">value=</span><span class="s">"${deal.image}"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span>æ”¯æŒjpgã€jpegã€pngã€gifæ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡2.0M<span class="nt">&lt;/p&gt;</span>
		<span class="nt">&lt;/div&gt;</span>
	<span class="nt">&lt;/div&gt;</span>	
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group text-center "</span><span class="nt">&gt;</span>
		<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-10 col-md-offset-1"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-lg"</span><span class="nt">&gt;</span>ä¿å­˜<span class="nt">&lt;/button&gt;</span>
		<span class="nt">&lt;/div&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>				
</code></pre></div></div>
<ol>
  <li>enctype=â€multipart/form-dataâ€å¿…ä¸å¯å°‘ã€‚</li>
  <li>onsubmit=â€return iframeCallback(this, pageAjaxDone)â€æ–¹æ³•ï¼Œé€šè¿‡ajaxæäº¤è¡¨å•ï¼ˆiframeCallbackï¼‰ï¼Œå¹¶ä¸”ä¸Šä¼ æˆåŠŸåè°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆpageAjaxDoneï¼‰è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</li>
</ol>

<p>å…³äºiframeCallbackçš„ä»‹ç»ï¼Œè¯·å‚ç…§<a href="http://blog.csdn.net/qing_gee/article/details/51027040#t13"> summernoteæ‰€åœ¨formè¡¨å•çš„æ•°æ®æäº¤</a>ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚</p>

<p>ç„¶åæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å›è°ƒå‡½æ•°pageAjaxDoneã€‚</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">pageAjaxDone</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">YUNM</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
	<span class="nx">YUNM</span><span class="p">.</span><span class="nx">ajaxDone</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">json</span><span class="p">[</span><span class="nx">YUNM</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">]</span> <span class="o">==</span> <span class="nx">YUNM</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">json</span><span class="p">[</span><span class="nx">YUNM</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">message</span><span class="p">];</span>
		<span class="c1">// å¼¹å‡ºæ¶ˆæ¯æç¤º</span>
		<span class="nx">YUNM</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">YUNM</span><span class="p">.</span><span class="nx">callbackType</span><span class="p">.</span><span class="nx">confirmTimeoutForward</span> <span class="o">==</span> <span class="nx">json</span><span class="p">.</span><span class="nx">callbackType</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">showSuccessTimeout</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">forwardUrl</span><span class="p">;</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å…¶ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡ajaxDoneæ–¹æ³•å¤„ç†æœåŠ¡ç«¯ä¼ é€’è¿‡æ¥çš„é”™è¯¯æ¶ˆæ¯ï¼Œå‡å¦‚è¯´æœåŠ¡ç«¯æ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆä¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼Œè¿›è€Œè·³è½¬åˆ°å¯¹åº”çš„urlã€‚</p>

<h3 id="å…­æœåŠ¡å™¨ç«¯ä¿å­˜å›¾ç‰‡">å…­ã€æœåŠ¡å™¨ç«¯ä¿å­˜å›¾ç‰‡</h3>

<p>è¯·å‚ç…§<a href="http://blog.csdn.net/qing_gee/article/details/51027040#t8">åç«¯springMVCæ–‡ä»¶ä¿å­˜</a></p>

<hr />
<p>psï¼šä»¥ä¸Šåšå®¢ç•™äº†ä¸€ä¸ªå°ç–‘é—®ï¼Œä¸€ç›´æ²¡æœ‰å»ç ”ç©¶ï¼Œç›´åˆ°æœ‰ä½éå¸¸æ£’çš„å°ä¼™ä¼´ ihchenchen ç»™äº†æˆ‘å¦‚ä¸‹çš„æé†’ï¼š</p>

<blockquote>
  <p>allowedFileTypes ã€allowedFileExtensions æˆ‘çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰æ•ˆæœï¼Œå› ä¸º fileinput() æ–¹æ³•è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡åœ¨ fileinput.js é‡Œé¢æœ€åå‡ è¡Œï¼Œè¿˜æœ‰ä¸€æ¬¡å°±æ˜¯ä½ è‡ªå·±å†™çš„ <code class="highlighter-rouge">$(this).fileinput()</code>ã€‚åœ¨fileinput.jsé‡Œçš„æ˜¯æ²¡æœ‰è®¾ç½®allowedFileTypes ã€allowedFileExtensions å€¼çš„ã€‚</p>
</blockquote>

<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ”¹ï¼š
1ã€æŠŠfileinput.jsé‡Œçš„æœ€åå‡ è¡Œè°ƒç”¨æ³¨é‡Šæ‰ã€‚
2ã€å…¨éƒ¨ä½¿ç”¨â€œdata-â€çš„æ–¹æ³•æ¥åšï¼Œä¸å†™$(this).fileinput()ã€‚</p>

<p>å¯¹äºihchenchenå–„æ„çš„æé†’ï¼Œæˆ‘éå¸¸çš„æ„Ÿè°¢ï¼Œè™½ç„¶ä»–æä¾›çš„è§£é‡Šå¹¶æ²¡æœ‰è§£å†³æˆ‘çš„ç–‘é—®ï¼Œä½†æ˜¯æˆ‘å¾ˆå–œæ¬¢è¿™æ ·æœ‰äº’åŠ¨çš„æŠ€æœ¯äº¤æµï¼Œä¹‹å‰å†™å¾ˆå¤šåšå®¢ï¼ŒåŸºæœ¬ä¸Šå¾ˆå°‘å‘ç”Ÿè¿™æ ·å–„æ„å¹¶ä¸”è¡Œä¹‹æœ‰æ•ˆçš„å›ç­”ã€‚è¿™è®©æˆ‘æƒ³èµ·<a href="http://www.jianshu.com/p/90a19c5d5cf0">ä¸­å›½ç¨‹åºå‘˜å’Œå¤–å›½ç¨‹åºå‘˜</a>ï¼Œé‡Œé¢çš„æ•…äº‹è®©äººéœ‡æ’¼ä¹‹ä½™ï¼Œæå¸¦ç€äº›è®¸çš„æƒ­æ„§ã€‚é‚£ä¹ˆå¦‚ä½•åšåˆ°â€œ<strong>Ask questions, get answers, no distractionsã€‚</strong>â€å°±æ˜¾å¾—ç‰¹åˆ«çè´µï¼Œè€Œâ€œihchenchenâ€åˆ™å……æ»¡è¿™ç§ç²¾ç¥ï¼</p>

<h3 id="å…­è§£æƒ‘allowedfiletypes-allowedfileextensions">å…­ã€è§£æƒ‘allowedFileTypes ã€allowedFileExtensions</h3>
<p>ä¹‹å‰å›°æƒ‘ä¸ºä»€ä¹ˆbootstrap fileinputä¸ºä»€ä¹ˆè®¾ç½®äº†è¿™ä¸¤ä¸ªå±æ€§åï¼Œæ²¡æœ‰æ•ˆæœï¼Œå…¶å®æ˜¯æˆ‘è‡ªå·±çš„è¯¯è§£ï¼Œå¦‚ä»Šç»è¿‡ä¸€ç•ªç—›å½»çš„é¢†æ‚Ÿåæç„¶å¤§æ‚Ÿï¼</p>

<h4 id="allowedfiletypes">â‘ ã€allowedFileTypes</h4>
<blockquote>
  <p>allowedFileTypes
array the list of allowed file types for upload. This by default is set to null which means the plugin supports all file types for upload. If an invalid file type is found, then a validation error message as set in msgInvalidFileType will be raised. The following types as set in fileTypeSettings are available for setup.</p>
</blockquote>

<blockquote>
  <p>[â€˜imageâ€™, â€˜htmlâ€™, â€˜textâ€™, â€˜videoâ€™, â€˜audioâ€™, â€˜flashâ€™, â€˜objectâ€™]</p>
</blockquote>

<p>å…ˆä»â€œallowedFileTypesâ€è¯´èµ·ï¼Œè¯¥å±æ€§å‘ŠçŸ¥æˆ‘ä»¬æ–‡ä»¶çš„é€‰æ‹©ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°è¿™æ ·çš„ç”»é¢ï¼š
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTYwMTI5MTYwODEyNDM1?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ­¤æ—¶çš„â€œæ‰€æœ‰æ–‡ä»¶â€å¤„ä¸æ˜¯â€œæ‰€æœ‰æ–‡ä»¶â€ï¼Œè€Œæ˜¯â€œimageâ€ä¹‹ç±»çš„ã€‚æ˜¾ç„¶è¿™æ ·çš„é€»è¾‘å¹¶æ²¡æœ‰é”™ï¼Œä½†å´ä¸é€‚åˆbootstrap fileinputï¼</p>

<p>é‚£ä¹ˆï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å°±å¾ˆå®¹æ˜“è®¤ä¸ºâ€œallowedFileTypesâ€ æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼</p>

<p>ä½†è¯·çœ‹ä¸‹å›¾ï¼š
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTYwMTI5MTYxMjU4Njky?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>å¼å¼ï¼ŒåŸæ¥æ˜¯åœ¨ä½ é€‰æ‹©äº†æ–‡ä»¶åå‘ç”Ÿçš„ç±»å‹æ£€æŸ¥ï¼</p>

<h4 id="allowedfiletypeså·¥ä½œåŸç†">â‘¡ã€allowedFileTypeså·¥ä½œåŸç†</h4>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fileinput</span><span class="p">({</span>
				<span class="na">showUpload</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
				<span class="na">showRemove</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
				<span class="na">language</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">zh</span><span class="dl">'</span><span class="p">,</span>
				<span class="na">allowedPreviewTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">],</span>
		        <span class="na">allowedFileTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">],</span>
		        <span class="na">allowedFileExtensions</span><span class="p">:</span>  <span class="p">[</span><span class="dl">'</span><span class="s1">jpg</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">png</span><span class="dl">'</span><span class="p">],</span>
				<span class="na">maxFileSize</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
				
			<span class="p">});</span>
</code></pre></div></div>
<p>é€šè¿‡fileinputæ–¹æ³•æˆ‘ä»¬åŠ è½½ä¸€ä¸ªbootstrap fileinputç»„ä»¶ï¼Œé‚£ä¹ˆå…¶å†…éƒ¨æ˜¯å¦‚ä½•å®ç°allowedFileTypesçš„å‘¢ï¼Ÿ</p>

<p>é€šè¿‡åœ¨fileinput.jsæ–‡ä»¶ä¸­æœç´¢â€œallowedFileTypesâ€å…³é”®å­—ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">ctr</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">previewId</span> <span class="o">=</span> <span class="nx">previewInitId</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">isText</span><span class="p">,</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                    <span class="nx">caption</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">slug</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span> <span class="nx">fileSize</span> <span class="o">=</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">size</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="nx">checkFile</span><span class="p">,</span> <span class="nx">fileExtExpr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">,</span>
                    <span class="nx">previewData</span> <span class="o">=</span> <span class="nx">objUrl</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span> <span class="nx">fileCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">typ</span><span class="p">,</span> <span class="nx">chk</span><span class="p">,</span>
                    <span class="nx">fileTypes</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">allowedFileTypes</span><span class="p">,</span> <span class="nx">strTypes</span> <span class="o">=</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">fileTypes</span><span class="p">)</span> <span class="p">?</span> <span class="dl">''</span> <span class="p">:</span> <span class="nx">fileTypes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">),</span>
                    <span class="nx">fileExt</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">allowedFileExtensions</span><span class="p">,</span> <span class="nx">strExt</span> <span class="o">=</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">fileExt</span><span class="p">)</span> <span class="p">?</span> <span class="dl">''</span> <span class="p">:</span> <span class="nx">fileExt</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<p>ç„¶åæˆ‘ä»¬ç»§ç»­çœ‹åˆ°å¦‚ä¸‹çš„ä»£ç ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">fileTypes</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">fileTypes</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">fileTypes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">typ</span> <span class="o">=</span> <span class="nx">fileTypes</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                        <span class="nx">checkFile</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">[</span><span class="nx">typ</span><span class="p">];</span>
                        <span class="nx">chk</span> <span class="o">=</span> <span class="p">(</span><span class="nx">checkFile</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">checkFile</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">caption</span><span class="p">));</span>
                        <span class="nx">fileCount</span> <span class="o">+=</span> <span class="nx">isEmpty</span><span class="p">(</span><span class="nx">chk</span><span class="p">)</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="nx">chk</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">fileCount</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">msg</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">msgInvalidFileType</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">{name}</span><span class="dl">'</span><span class="p">,</span> <span class="nx">caption</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">{types}</span><span class="dl">'</span><span class="p">,</span> <span class="nx">strTypes</span><span class="p">);</span>
                        <span class="nb">self</span><span class="p">.</span><span class="nx">isError</span> <span class="o">=</span> <span class="nx">throwError</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">previewId</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ–‡ä»¶ç±»å‹çš„æ£€æŸ¥æ˜¯å‘ç”Ÿåœ¨checkFileæ–¹æ³•ä¸Šï¼Œé‚£ä¹ˆcheckFileæ–¹æ³•åˆ°åº•åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">defaultFileTypeSettings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">image</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vType</span><span class="p">,</span> <span class="nx">vName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">vType</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">?</span> <span class="nx">vType</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">image.*</span><span class="dl">'</span><span class="p">)</span> <span class="p">:</span> <span class="nx">vName</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpe</span><span class="se">?</span><span class="sr">g</span><span class="se">)</span><span class="sr">$/i</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="p">...</span>
</code></pre></div></div>
<p>ä»¥ä¸Šå°±æ˜¯checkFileçš„å†…å®¹ã€‚</p>

<ol>
  <li>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æŒ‡å®š<code class="highlighter-rouge">allowedFileTypes: ['image'],</code>æ—¶ï¼Œå°±ä¼šè¿›è¡Œimageçš„ç±»å‹æ£€æŸ¥ã€‚</li>
  <li>æ˜¾ç„¶æˆ‘ä»¬é€‰æ‹©çš„txtæ–‡ä»¶ä¸å±äºimageç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šåŒ¹é…ä¸ä¸Šï¼Œå‡ºç°ä»¥ä¸Šç•Œé¢ã€‚</li>
  <li>åŒæ—¶ï¼Œè¯¥æ–¹æ³•å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“ä¸æŒ‡å®š<code class="highlighter-rouge">allowedFileTypes: ['image'],</code>ï¼ŒåªæŒ‡å®š<code class="highlighter-rouge">allowedFileExtensions:  ['jpg', 'png'],</code>å°±ä¼šæ‰§è¡Œ<code class="highlighter-rouge">vName.match(/\.(png|jpe?g)$/i)</code>ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶åç¼€ç±»å‹çš„æ£€æŸ¥ï¼Œè¿™ç‚¹å¾ˆå…³é”®å•Šï¼Œä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»â€œallowedFileExtensionsâ€å¥ å®šåŸºç¡€ã€‚</li>
</ol>

<h4 id="allowedfileextensionsä»€ä¹ˆæ—¶å€™èµ·ä½œç”¨">â‘¢ã€allowedFileExtensionsä»€ä¹ˆæ—¶å€™èµ·ä½œç”¨</h4>
<p>ä¸ŠèŠ‚æˆ‘ä»¬è®¨è®ºå®Œâ€œallowedFileTypesâ€ï¼Œæå¸¦è¯´äº†â€œallowedFileExtensionsâ€ï¼Œé‚£ä¹ˆå¦‚ä½•è®©åç¼€è¿›è¡Œcheckå‘¢ï¼Ÿ</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fileinput</span><span class="p">({</span>
				<span class="na">showUpload</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
				<span class="na">showRemove</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
				<span class="na">language</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">zh</span><span class="dl">'</span><span class="p">,</span>
				<span class="na">allowedPreviewTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">],</span>
		        <span class="na">allowedFileExtensions</span><span class="p">:</span>  <span class="p">[</span><span class="dl">'</span><span class="s1">jpg</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">png</span><span class="dl">'</span><span class="p">],</span>
				<span class="na">maxFileSize</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
				
			<span class="p">});</span>
</code></pre></div></div>
<p>fileinputç»„ä»¶æ­¤æ—¶æŒ‡å®šçš„å±æ€§å¦‚ä¸Šï¼Œæ²¡æœ‰äº†â€œallowedFileTypesâ€ï¼Œå¹¶ä¸”æŒ‡å®šå…è®¸çš„åç¼€ç±»å‹ä¸ºâ€œ[â€˜jpgâ€™, â€˜pngâ€™]â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚æˆ‘ä»¬é€‰æ‹©äº†gifçš„å›¾ç‰‡å°±ä¼šå‡ºç°é”™è¯¯æç¤ºã€‚
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTYwMTI5MTYyODQ1NzU5?x-oss-process=image/format,png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p>é”™è¯¯é¢„æœŸçš„å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆè¯·ç‰¹åˆ«æ³¨æ„ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">image</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vType</span><span class="p">,</span> <span class="nx">vName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">vType</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">?</span> <span class="nx">vType</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">image.*</span><span class="dl">'</span><span class="p">)</span> <span class="p">:</span> <span class="nx">vName</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpe</span><span class="se">?</span><span class="sr">g</span><span class="se">)</span><span class="sr">$/i</span><span class="p">);</span>
        <span class="p">},</span>
</code></pre></div></div>
<p>fileinput.jsæ–‡ä»¶ä¸­åŸå§‹çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">image</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vType</span><span class="p">,</span> <span class="nx">vName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">vType</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">?</span> <span class="nx">vType</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">'</span><span class="s1">image.*</span><span class="dl">'</span><span class="p">)</span> <span class="p">:</span> <span class="nx">vName</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\.(</span><span class="sr">gif|png|jpe</span><span class="se">?</span><span class="sr">g</span><span class="se">)</span><span class="sr">$/i</span><span class="p">);</span>
        <span class="p">},</span>
</code></pre></div></div>
<p>imageç±»å‹çš„åç¼€å½“ç„¶é»˜è®¤åŒ…å«äº†gifï¼Œæˆ‘åªæ˜¯ä¸ºäº†ä¸¾ä¾‹è¯´æ˜ï¼Œä»£ç åšäº†è°ƒæ•´ï¼Œè¯·æ³¨æ„ï¼</p>

:ET