I"˜È<p>å¯¹äº Java çš„åºåˆ—åŒ–ï¼Œæˆ‘ä¸€ç›´åœç•™åœ¨æœ€æµ…æ˜¾çš„è®¤çŸ¥ä¸Šâ€”â€”æŠŠé‚£ä¸ªè¦åºåˆ—åŒ–çš„ç±»å®ç° <code class="highlighter-rouge">Serializbale</code> æ¥å£å°±å¯ä»¥äº†ã€‚æˆ‘ä¸æ„¿æ„åšæ›´æ·±å…¥çš„ç ”ç©¶ï¼Œå› ä¸ºä¼šç”¨å°±è¡Œäº†å˜›ã€‚</p>

<!--more-->

<p>ä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè§åˆ° <code class="highlighter-rouge">Serializbale</code> çš„æ¬¡æ•°è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä¾¿å¯¹å®ƒäº§ç”Ÿäº†æµ“åšçš„å…´è¶£ã€‚æ˜¯æ—¶å€™èŠ±ç‚¹æ—¶é—´ç ”ç©¶ç ”ç©¶äº†ã€‚</p>

<h3 id="01å…ˆæ¥ç‚¹ç†è®º">01ã€å…ˆæ¥ç‚¹ç†è®º</h3>

<p>Java åºåˆ—åŒ–æ˜¯ JDK 1.1 æ—¶å¼•å…¥çš„ä¸€ç»„å¼€åˆ›æ€§çš„ç‰¹æ€§ï¼Œç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¾¿äºå­˜å‚¨æˆ–ä¼ è¾“ã€‚æ­¤åï¼Œä»ç„¶å¯ä»¥å°†å­—èŠ‚æ•°ç»„è½¬æ¢å› Java å¯¹è±¡åŸæœ‰çš„çŠ¶æ€ã€‚</p>

<p>åºåˆ—åŒ–çš„æ€æƒ³æ˜¯â€œå†»ç»“â€å¯¹è±¡çŠ¶æ€ï¼Œç„¶åå†™åˆ°ç£ç›˜æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›ååºåˆ—åŒ–çš„æ€æƒ³æ˜¯â€œè§£å†»â€å¯¹è±¡çŠ¶æ€ï¼Œé‡æ–°è·å¾—å¯ç”¨çš„ Java å¯¹è±¡ã€‚</p>

<p>å†æ¥çœ‹çœ‹åºåˆ—åŒ– <code class="highlighter-rouge">Serializbale</code> æ¥å£çš„å®šä¹‰ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Serializable</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>æ˜æ˜å°±ä¸€ä¸ªç©ºçš„<a href="http://www.itwanger.com/java/2019/11/14/java-interface-abstract.html">æ¥å£</a>å˜›ï¼Œç«Ÿç„¶èƒ½å¤Ÿä¿è¯å®ç°äº†å®ƒçš„â€œç±»çš„å¯¹è±¡â€è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</p>

<h3 id="02å†æ¥ç‚¹å®æˆ˜">02ã€å†æ¥ç‚¹å®æˆ˜</h3>

<p>åœ¨å›ç­”ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªç±»ï¼ˆåªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå’Œå¯¹åº”çš„ <code class="highlighter-rouge">getter/setter</code>ï¼‰ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å†æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œé€šè¿‡ <code class="highlighter-rouge">ObjectOutputStream</code> å°†â€œ18 å²çš„ç‹äºŒâ€å†™å…¥åˆ°æ–‡ä»¶å½“ä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼›å†é€šè¿‡ <code class="highlighter-rouge">ObjectInputStream</code> å°†â€œ18 å²çš„ç‹äºŒâ€ä»æ–‡ä»¶ä¸­è¯»å‡ºæ¥ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç§ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// åˆå§‹åŒ–</span>
        <span class="nc">Wanger</span> <span class="n">wanger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wanger</span><span class="o">();</span>
        <span class="n">wanger</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ç‹äºŒ"</span><span class="o">);</span>
        <span class="n">wanger</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">18</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>

        <span class="c1">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">));){</span>
            <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">)));){</span>
            <span class="nc">Wanger</span> <span class="n">wanger1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Wanger</span><span class="o">)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>ä¸è¿‡ï¼Œç”±äº <code class="highlighter-rouge">Wanger</code> æ²¡æœ‰å®ç° <code class="highlighter-rouge">Serializbale</code> æ¥å£ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæµ‹è¯•ç±»çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå †æ ˆä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.io.NotSerializableException: com.cmower.java_demo.xuliehua.Wanger
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)
	at com.cmower.java_demo.xuliehua.Test.main(Test.java:21)
</code></pre></div></div>

<p>é¡ºç€å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code class="highlighter-rouge">ObjectOutputStream</code> çš„ <code class="highlighter-rouge">writeObject0()</code> æ–¹æ³•ã€‚å…¶éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (obj instanceof String) {
    writeString((String) obj, unshared);
} else if (cl.isArray()) {
    writeArray(obj, desc, unshared);
} else if (obj instanceof Enum) {
    writeEnum((Enum&lt;?&gt;) obj, desc, unshared);
} else if (obj instanceof Serializable) {
    writeOrdinaryObject(obj, desc, unshared);
} else {
    if (extendedDebugInfo) {
        throw new NotSerializableException(
            cl.getName() + "\n" + debugInfoStack.toString());
    } else {
        throw new NotSerializableException(cl.getName());
    }
}
</code></pre></div></div>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code class="highlighter-rouge">ObjectOutputStream</code> åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­è¢«åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯å“ªä¸€ç§ç±»å‹ï¼Œå­—ç¬¦ä¸²ï¼Ÿæ•°ç»„ï¼Ÿæšä¸¾ï¼Ÿè¿˜æ˜¯ <code class="highlighter-rouge">Serializable</code>ï¼Œå¦‚æœå…¨éƒ½ä¸æ˜¯çš„è¯ï¼ŒæŠ›å‡º <code class="highlighter-rouge">NotSerializableException</code>ã€‚</p>

<p>å‡å¦‚ <code class="highlighter-rouge">Wanger</code> å®ç°äº† <code class="highlighter-rouge">Serializable</code> æ¥å£ï¼Œå°±å¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="kd">implements</span> <span class="nc">Serializable</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2095916884810199532L</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å…·ä½“æ€ä¹ˆåºåˆ—åŒ–å‘¢ï¼Ÿ</p>

<p>ä»¥ <code class="highlighter-rouge">ObjectOutputStream</code> ä¸ºä¾‹å§ï¼Œå®ƒåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code class="highlighter-rouge">writeObject()</code>â†’<code class="highlighter-rouge">writeObject0()</code>â†’<code class="highlighter-rouge">writeOrdinaryObject()</code>â†’<code class="highlighter-rouge">writeSerialData()</code>â†’<code class="highlighter-rouge">invokeWriteObject()</code>â†’<code class="highlighter-rouge">defaultWriteFields()</code>ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">defaultWriteFields</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">ObjectStreamClass</span> <span class="n">desc</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">IOException</span>
    <span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cl</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">forClass</span><span class="o">();</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">checkDefaultSerialize</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">primDataSize</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">getPrimDataSize</span><span class="o">();</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">getPrimFieldValues</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">primVals</span><span class="o">);</span>
        <span class="n">bout</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">primVals</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">primDataSize</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="nc">ObjectStreamField</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">getFields</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="nc">Object</span><span class="o">[]</span> <span class="n">objVals</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">desc</span><span class="o">.</span><span class="na">getNumObjFields</span><span class="o">()];</span>
        <span class="kt">int</span> <span class="n">numPrimFields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">objVals</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">getObjFieldValues</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">objVals</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">objVals</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">writeObject0</span><span class="o">(</span><span class="n">objVals</span><span class="o">[</span><span class="n">i</span><span class="o">],</span>
                             <span class="n">fields</span><span class="o">[</span><span class="n">numPrimFields</span> <span class="o">+</span> <span class="n">i</span><span class="o">].</span><span class="na">isUnshared</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>é‚£æ€ä¹ˆååºåˆ—åŒ–å‘¢ï¼Ÿ</p>

<p>ä»¥ <code class="highlighter-rouge">ObjectInputStream</code> ä¸ºä¾‹ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code class="highlighter-rouge">readObject()</code>â†’<code class="highlighter-rouge">readObject0()</code>â†’<code class="highlighter-rouge">readOrdinaryObject()</code>â†’<code class="highlighter-rouge">readSerialData()</code>â†’<code class="highlighter-rouge">defaultReadFields()</code>ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">defaultWriteFields</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">ObjectStreamClass</span> <span class="n">desc</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">IOException</span>
    <span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cl</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">forClass</span><span class="o">();</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">checkDefaultSerialize</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">primDataSize</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">getPrimDataSize</span><span class="o">();</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">getPrimFieldValues</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">primVals</span><span class="o">);</span>
        <span class="n">bout</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">primVals</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">primDataSize</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

        <span class="nc">ObjectStreamField</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">getFields</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="nc">Object</span><span class="o">[]</span> <span class="n">objVals</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="n">desc</span><span class="o">.</span><span class="na">getNumObjFields</span><span class="o">()];</span>
        <span class="kt">int</span> <span class="n">numPrimFields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">objVals</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="n">desc</span><span class="o">.</span><span class="na">getObjFieldValues</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">objVals</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">objVals</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">writeObject0</span><span class="o">(</span><span class="n">objVals</span><span class="o">[</span><span class="n">i</span><span class="o">],</span>
                             <span class="n">fields</span><span class="o">[</span><span class="n">numPrimFields</span> <span class="o">+</span> <span class="n">i</span><span class="o">].</span><span class="na">isUnshared</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>æˆ‘æƒ³çœ‹åˆ°è¿™ï¼Œä½ åº”è¯¥ä¼šæç„¶å¤§æ‚Ÿçš„â€œå“¦â€ä¸€å£°äº†ã€‚<code class="highlighter-rouge">Serializable</code> æ¥å£ä¹‹æ‰€ä»¥å®šä¹‰ä¸ºç©ºï¼Œæ˜¯å› ä¸ºå®ƒåªèµ·åˆ°äº†ä¸€ä¸ªæ ‡è¯†çš„ä½œç”¨ï¼Œå‘Šè¯‰ç¨‹åºå®ç°äº†å®ƒçš„å¯¹è±¡æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œä½†çœŸæ­£åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œå¹¶ä¸éœ€è¦å®ƒæ¥å®Œæˆã€‚</p>

<h3 id="03å†æ¥ç‚¹æ³¨æ„äº‹é¡¹">03ã€å†æ¥ç‚¹æ³¨æ„äº‹é¡¹</h3>

<p>å¼€é—¨è§å±±çš„è¯´å§ï¼Œ<code class="highlighter-rouge">static</code> å’Œ <code class="highlighter-rouge">transient</code> ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ã€‚</p>

<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥è¯æ˜ï¼Œå†æ¥è§£é‡ŠåŸå› ã€‚</p>

<p>é¦–å…ˆï¼Œåœ¨ <code class="highlighter-rouge">Wanger</code> ç±»ä¸­å¢åŠ ä¸¤ä¸ªå­—æ®µã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2095916884810199532L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">pre</span> <span class="o">=</span> <span class="s">"æ²‰é»˜"</span><span class="o">;</span>
    <span class="kd">transient</span> <span class="nc">String</span> <span class="n">meizi</span> <span class="o">=</span> <span class="s">"ç‹ä¸‰"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Wanger{"</span> <span class="o">+</span> <span class="s">"name="</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">",age="</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">",pre="</span> <span class="o">+</span> <span class="n">pre</span> <span class="o">+</span> <span class="s">",meizi="</span> <span class="o">+</span> <span class="n">meizi</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å…¶æ¬¡ï¼Œåœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå¹¶åœ¨åºåˆ—åŒ–åå’Œååºåˆ—åŒ–å‰æ”¹å˜ <code class="highlighter-rouge">static</code> å­—æ®µçš„å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆå§‹åŒ–</span>
<span class="nc">Wanger</span> <span class="n">wanger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wanger</span><span class="o">();</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ç‹äºŒ"</span><span class="o">);</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">18</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>

<span class="c1">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">));){</span>
        <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
   
    <span class="c1">// æ”¹å˜ static å­—æ®µçš„å€¼</span>
<span class="nc">Wanger</span><span class="o">.</span><span class="na">pre</span> <span class="o">=</span><span class="s">"ä¸æ²‰é»˜"</span><span class="o">;</span>

<span class="c1">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">)));){</span>
    <span class="nc">Wanger</span> <span class="n">wanger1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Wanger</span><span class="o">)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger1</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// Wanger{name=ç‹äºŒ,age=18,pre=æ²‰é»˜,meizi=ç‹ä¸‰}</span>
<span class="c1">// Wanger{name=ç‹äºŒ,age=18,pre=ä¸æ²‰é»˜,meizi=null}</span>

</code></pre></div></div>

<p>ä»ç»“æœçš„å¯¹æ¯”å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p>

<p>1ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code class="highlighter-rouge">pre</code> çš„å€¼ä¸ºâ€œæ²‰é»˜â€ï¼Œåºåˆ—åŒ–åï¼Œ<code class="highlighter-rouge">pre</code> çš„å€¼ä¿®æ”¹ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œååºåˆ—åŒ–åï¼Œ<code class="highlighter-rouge">pre</code> çš„å€¼ä¸ºâ€œä¸æ²‰é»˜â€ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œæ²‰é»˜â€ã€‚</p>

<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåºåˆ—åŒ–ä¿å­˜çš„æ˜¯å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œ <code class="highlighter-rouge">static</code> ä¿®é¥°çš„å­—æ®µå±äºç±»çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥è¯æ˜åºåˆ—åŒ–å¹¶ä¸ä¿å­˜ <code class="highlighter-rouge">static</code> ä¿®é¥°çš„å­—æ®µã€‚</p>

<p>2ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code class="highlighter-rouge">meizi</code> çš„å€¼ä¸ºâ€œç‹ä¸‰â€ï¼Œååºåˆ—åŒ–åï¼Œ<code class="highlighter-rouge">meizi</code> çš„å€¼ä¸º <code class="highlighter-rouge">null</code>ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œç‹ä¸‰â€ã€‚</p>

<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<code class="highlighter-rouge">transient</code> çš„ä¸­æ–‡å­—ä¹‰ä¸ºâ€œä¸´æ—¶çš„â€ï¼ˆè®ºè‹±è¯­çš„é‡è¦æ€§ï¼‰ï¼Œå®ƒå¯ä»¥é˜»æ­¢å­—æ®µè¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œ<code class="highlighter-rouge">transient</code> å­—æ®µçš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œæ¯”å¦‚ <code class="highlighter-rouge">int</code> å‹çš„åˆå§‹å€¼ä¸º 0ï¼Œå¯¹è±¡å‹çš„åˆå§‹å€¼ä¸º <code class="highlighter-rouge">null</code>ã€‚</p>

<p>å¦‚æœæƒ³è¦æ·±ç©¶æºç çš„è¯ï¼Œä½ å¯ä»¥åœ¨ <code class="highlighter-rouge">ObjectStreamClass</code> ä¸­å‘ç°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="nc">ObjectStreamField</span><span class="o">[]</span> <span class="nf">getDefaultSerialFields</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cl</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Field</span><span class="o">[]</span> <span class="n">clFields</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
    <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">ObjectStreamField</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">STATIC</span> <span class="o">|</span> <span class="nc">Modifier</span><span class="o">.</span><span class="na">TRANSIENT</span><span class="o">;</span>

    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">?</span> <span class="no">NO_FIELDS</span> <span class="o">:</span>
        <span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">ObjectStreamField</span><span class="o">[</span><span class="n">size</span><span class="o">]);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>çœ‹åˆ° <code class="highlighter-rouge">Modifier.STATIC | Modifier.TRANSIENT</code>ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰æ›´å¥½äº†å‘¢ï¼Ÿ</p>

<h3 id="04å†æ¥ç‚¹å¹²è´§">04ã€å†æ¥ç‚¹å¹²è´§</h3>

<p>é™¤äº† <code class="highlighter-rouge">Serializable</code> ä¹‹å¤–ï¼ŒJava è¿˜æä¾›äº†ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ <code class="highlighter-rouge">Externalizable</code>ï¼ˆå¿µèµ·æ¥æœ‰ç‚¹æ‹—å£ï¼‰ã€‚</p>

<p>ä¸¤ä¸ªæ¥å£æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„å—ï¼Ÿè¯•ä¸€è¯•å°±çŸ¥é“äº†ã€‚</p>

<p>é¦–å…ˆï¼ŒæŠŠ <code class="highlighter-rouge">Wanger</code> ç±»å®ç°çš„æ¥å£  <code class="highlighter-rouge">Serializable</code> æ›¿æ¢ä¸º <code class="highlighter-rouge">Externalizable</code>ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="kd">implements</span> <span class="nc">Externalizable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Wanger</span><span class="o">()</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Wanger{"</span> <span class="o">+</span> <span class="s">"name="</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">",age="</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeExternal</span><span class="o">(</span><span class="nc">ObjectOutput</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">readExternal</span><span class="o">(</span><span class="nc">ObjectInput</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>

	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>å®ç° <code class="highlighter-rouge">Externalizable</code> æ¥å£çš„ <code class="highlighter-rouge">Wanger</code> ç±»å’Œå®ç° <code class="highlighter-rouge">Serializable</code> æ¥å£çš„ <code class="highlighter-rouge">Wanger</code> ç±»æœ‰ä¸€äº›ä¸åŒï¼š</p>

<p>1ï¼‰æ–°å¢äº†ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ã€‚</p>

<p>ä½¿ç”¨ <code class="highlighter-rouge">Externalizable</code> è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ æ–¹æ³•å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå†å°†è¢«ä¿å­˜å¯¹è±¡çš„å­—æ®µå€¼å¤åˆ¶è¿‡å»ã€‚å¦åˆ™çš„è¯ï¼Œä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.io.InvalidClassException: com.cmower.java_demo.xuliehua1.Wanger; no valid constructor
	at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:150)
	at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:790)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1782)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1353)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:373)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
</code></pre></div></div>

<p>2ï¼‰æ–°å¢äº†ä¸¤ä¸ªæ–¹æ³• <code class="highlighter-rouge">writeExternal()</code> å’Œ <code class="highlighter-rouge">readExternal()</code>ï¼Œå®ç° <code class="highlighter-rouge">Externalizable</code> æ¥å£æ‰€å¿…é¡»çš„ã€‚</p>

<p>ç„¶åï¼Œæˆ‘ä»¬å†åœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆå§‹åŒ–</span>
<span class="nc">Wanger</span> <span class="n">wanger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wanger</span><span class="o">();</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ç‹äºŒ"</span><span class="o">);</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">18</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>

<span class="c1">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">));)</span> <span class="o">{</span>
	<span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">)));)</span> <span class="o">{</span>
	<span class="nc">Wanger</span> <span class="n">wanger1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Wanger</span><span class="o">)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger1</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// Wanger{name=ç‹äºŒ,age=18}</span>
<span class="c1">// Wanger{name=null,age=0}</span>
</code></pre></div></div>

<p>ä»è¾“å‡ºçš„ç»“æœçœ‹ï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡å­—æ®µéƒ½å˜æˆäº†é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–ä¹‹å‰çš„å¯¹è±¡çŠ¶æ€æ²¡æœ‰è¢«â€œå†»ç»“â€ä¸‹æ¥ã€‚</p>

<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º <code class="highlighter-rouge">Wanger</code> ç±»é‡å†™å…·ä½“çš„ <code class="highlighter-rouge">writeExternal()</code> å’Œ <code class="highlighter-rouge">readExternal()</code> æ–¹æ³•ã€‚é‚£è¯¥æ€ä¹ˆé‡å†™å‘¢ï¼Ÿ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeExternal</span><span class="o">(</span><span class="nc">ObjectOutput</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
	<span class="n">out</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
	<span class="n">out</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">age</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">readExternal</span><span class="o">(</span><span class="nc">ObjectInput</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
	<span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
	<span class="n">age</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1ï¼‰è°ƒç”¨ <code class="highlighter-rouge">ObjectOutput</code> çš„ <code class="highlighter-rouge">writeObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code class="highlighter-rouge">name</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›</p>

<p>2ï¼‰è°ƒç”¨ <code class="highlighter-rouge">ObjectOutput</code> çš„ <code class="highlighter-rouge">writeInt()</code> æ–¹æ³•å°†æ•´å‹çš„ <code class="highlighter-rouge">age</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›</p>

<p>3ï¼‰è°ƒç”¨ <code class="highlighter-rouge">ObjectInput</code> çš„ <code class="highlighter-rouge">readObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code class="highlighter-rouge">name</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›</p>

<p>4ï¼‰è°ƒç”¨ <code class="highlighter-rouge">ObjectInput</code> çš„ <code class="highlighter-rouge">readInt()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code class="highlighter-rouge">age</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›</p>

<p>å†è¿è¡Œä¸€æ¬¡æµ‹è¯•äº†ç±»ï¼Œä½ ä¼šå‘ç°å¯¹è±¡å¯ä»¥æ­£å¸¸åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p>

<blockquote>
  <p>åºåˆ—åŒ–å‰ï¼šWanger{name=ç‹äºŒ,age=18}
åºåˆ—åŒ–åï¼šWanger{name=ç‹äºŒ,age=18}</p>
</blockquote>

<h3 id="05å†æ¥ç‚¹ç”œç‚¹">05ã€å†æ¥ç‚¹ç”œç‚¹</h3>

<p>è®©æˆ‘å…ˆé—®é—®ä½ å§ï¼Œä½ çŸ¥é“ ` private static final long serialVersionUID = -2095916884810199532L;` è¿™æ®µä»£ç çš„ä½œç”¨å—ï¼Ÿ</p>

<p>å—¯â€¦â€¦</p>

<p><code class="highlighter-rouge">serialVersionUID</code> è¢«ç§°ä¸ºåºåˆ—åŒ– IDï¼Œå®ƒæ˜¯å†³å®š Java å¯¹è±¡èƒ½å¦ååºåˆ—åŒ–æˆåŠŸçš„é‡è¦å› å­ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠå­—èŠ‚æµä¸­çš„ <code class="highlighter-rouge">serialVersionUID</code> ä¸è¢«åºåˆ—åŒ–ç±»ä¸­çš„ <code class="highlighter-rouge">serialVersionUID</code> è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºåºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚</p>

<p>å½“ä¸€ä¸ªç±»å®ç°äº† <code class="highlighter-rouge">Serializable</code> æ¥å£åï¼ŒIDE å°±ä¼šæé†’è¯¥ç±»æœ€å¥½äº§ç”Ÿä¸€ä¸ªåºåˆ—åŒ– IDï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>

<p><img src="https://upload-images.jianshu.io/upload_images/1179389-2bcfa763105b45aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>1ï¼‰æ·»åŠ ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬çš„åºåˆ—åŒ– IDï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="err">ã€‚</span>
</code></pre></div></div>

<p>2ï¼‰æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„ä¸é‡å¤çš„åºåˆ—åŒ– IDã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2095916884810199532L</span><span class="o">;</span>
</code></pre></div></div>

<p>3ï¼‰æ·»åŠ  <code class="highlighter-rouge">@SuppressWarnings</code> æ³¨è§£ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
</code></pre></div></div>

<p>æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§åŠæ³•ï¼Œåœ¨è¢«åºåˆ—åŒ–ç±»ä¸­æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„åºåˆ—åŒ– IDã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2095916884810199532L</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

	<span class="c1">// å…¶ä»–ä»£ç å¿½ç•¥</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ç„¶åï¼Œåºåˆ—åŒ–ä¸€ä¸ª <code class="highlighter-rouge">Wanger</code> å¯¹è±¡åˆ°æ–‡ä»¶ä¸­ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆå§‹åŒ–</span>
<span class="nc">Wanger</span> <span class="n">wanger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Wanger</span><span class="o">();</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ç‹äºŒ"</span><span class="o">);</span>
<span class="n">wanger</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">18</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>

<span class="c1">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">));)</span> <span class="o">{</span>
	<span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ‚„æ‚„åœ°æŠŠ <code class="highlighter-rouge">Wanger</code> ç±»çš„åºåˆ—åŒ– ID å·æ¢æ¢æŸ±ä¸€ä¸‹ï¼Œå˜¿å˜¿ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// private static final long serialVersionUID = -2095916884810199532L;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2095916884810199533L</span><span class="o">;</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œå‡†å¤‡ååºåˆ—åŒ–å§ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"chenmo"</span><span class="o">)));)</span> <span class="o">{</span>
	<span class="nc">Wanger</span> <span class="n">wanger</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Wanger</span><span class="o">)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wanger</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å“å‘€ï¼Œå‡ºé”™äº†ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.io.InvalidClassException:  local class incompatible: stream classdesc 
serialVersionUID = -2095916884810199532,
local class serialVersionUID = -2095916884810199533
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
</code></pre></div></div>

<p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œä»æŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID å’Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚</p>

<p>é‚£å‡å¦‚æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸º <code class="highlighter-rouge">Wanger</code> ç±»æ·»åŠ ä¸ª <code class="highlighter-rouge">@SuppressWarnings("serial")</code> æ³¨è§£å‘¢ï¼Ÿ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Wanger3</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
<span class="c1">// çœç•¥å…¶ä»–ä»£ç </span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¥½äº†ï¼Œå†æ¥ä¸€æ¬¡ååºåˆ—åŒ–å§ã€‚å¯æƒœä¾ç„¶æŠ¥é”™ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.io.InvalidClassException:  local class incompatible: stream classdesc 
serialVersionUID = -2095916884810199532, 
local class serialVersionUID = -3818877437117647968
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)
	at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)
</code></pre></div></div>

<p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸º -3818877437117647968ï¼Œå’ŒæŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID ä»ç„¶ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚è¿™è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨ <code class="highlighter-rouge">@SuppressWarnings("serial")</code> æ³¨è§£æ—¶ï¼Œè¯¥æ³¨è§£ä¼šä¸ºè¢«åºåˆ—åŒ–ç±»è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„åºåˆ—åŒ– IDã€‚</p>

<p>ç”±æ­¤å¯ä»¥è¯æ˜ï¼ŒJava è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ å°±æ˜¯åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´ã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œé‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ– IDï¼ˆ1Lï¼‰å°±å¯ä»¥ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»£ç ä¸€è‡´æ—¶ååºåˆ—åŒ–æˆåŠŸã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wanger</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
<span class="c1">// çœç•¥å…¶ä»–ä»£ç </span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="06å†æ¥ç‚¹æ€»ç»“">06ã€å†æ¥ç‚¹æ€»ç»“</h3>

<p>å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘çœŸæ²¡æƒ³åˆ°ï¼šâ€œç©ºç©ºå…¶èº«â€çš„<code class="highlighter-rouge">Serializable</code> ç«Ÿç„¶æœ‰è¿™ä¹ˆå¤šå¯ä»¥ç ”ç©¶çš„å†…å®¹ï¼</p>

<p>å†™å®Œè¿™ç¯‡æ–‡ç« ä¹‹åï¼Œæˆ‘ä¸ç”±å¾—æƒ³èµ·ç†ç§‘çŠ¶å…ƒæ›¹æ—èè¯´è¯´è¿‡çš„ä¸€å¥è¯ï¼šâ€œåœ¨å­¦ä¹ ä¸­å†å°çš„é—®é¢˜ä¹Ÿä¸æ”¾è¿‡ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦æ€»ç»“â€â€”â€”è¯´å¾—çœŸçœŸçœŸçœŸçš„å¯¹å•Šï¼</p>

<p>è°¢è°¢å¤§å®¶çš„é˜…è¯»ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œå–œæ¬¢å°±å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ã€Œ<strong>æ²‰é»˜ç‹äºŒ</strong>ã€ï¼Œå›å¤ã€Œ1024ã€å“åˆ°ä½ ã€‚</p>
:ET