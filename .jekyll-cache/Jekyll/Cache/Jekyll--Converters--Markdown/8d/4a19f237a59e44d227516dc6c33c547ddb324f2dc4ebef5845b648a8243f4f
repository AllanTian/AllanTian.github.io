I"Ow<p>äºŒå“¥ï¼Œæˆ‘ä»Šå¹´å¤§äºŒï¼Œçœ‹ä½ åˆ†äº«çš„ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸Šæœ‰ä¸€æ®µå†…å®¹è¯´ï¼šâ€œå¾ªç¯ä½“å†…ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²æœ€å¥½ä½¿ç”¨ StringBuilder çš„ append æ–¹æ³•ï¼Œè€Œä¸æ˜¯ + å·æ“ä½œç¬¦ã€‚â€åˆ°åº•ä¸ºä»€ä¹ˆå•Šï¼Œæˆ‘å¹³å¸¸ä¸€ç›´å°±ç”¨çš„â€˜+â€™å·æ“ä½œç¬¦å•Šï¼äºŒå“¥æœ‰ç©ºçš„æ—¶å€™èƒ½å¦å†™ä¸€ç¯‡æ–‡ç« åˆ†æä¸€ä¸‹å‘¢ï¼Ÿ</p>

<!--more-->

<p>å°±åœ¨æ˜¨å¤©ï¼Œä¸€ä½å«å°èœçš„è¯»è€…å¾®ä¿¡æˆ‘è¯´äº†ä¸Šé¢è¿™æ®µè¯ã€‚</p>

<p>æˆ‘å½“æ—¶çœ‹åˆ°è¿™æ¡å¾®ä¿¡çš„ç¬¬ä¸€æ„Ÿè§‰æ˜¯ï¼šå°èœä½ ä¹Ÿå¤ªèœäº†å§ï¼Œè¿™éƒ½ä¸çŸ¥é“ä¸ºå•¥å•Šï¼æˆ‘ä¼°è®¡æ­£åœ¨è¯»è¿™ç¯‡æ–‡ç« çš„ä½ ä¹Ÿä¼šæœ‰åŒæ ·çš„æ„Ÿè§‰ã€‚</p>

<p>ä½†æ‰ªå¿ƒè‡ªé—®ï¼Œåœ¨<a href="https://mp.weixin.qq.com/s/feoOINGSyivBO8Z1gaQVOA">æˆ‘</a>åšç¨‹åºå‘˜çš„å‰ä¸¤å¹´å†…ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥ã€‚é‡åˆ°<a href="http://www.itwanger.com/java/2019/11/08/java-string.html">å­—ç¬¦ä¸²</a>æ‹¼æ¥å°±ä¸Šâ€œ+â€å·æ“ä½œç¬¦ï¼Œç”­ç®¡æ˜¯ä¸æ˜¯åœ¨å¾ªç¯ä½“å†…ã€‚å’Œå°èœæ¯”èµ·æ¥ï¼Œæˆ‘å½“æ—¶å¯æ²¡ä»–è¿™ä¹ˆå¹¸è¿ï¼Œè¿˜æœ‰ä¸€ä½çƒ­å¿ƒçš„â€œäºŒå“¥â€èƒ½å¤Ÿåˆ†äº«è¿™ä»½ä»·å€¼è¿åŸçš„å¼€å‘æ‰‹å†Œã€‚</p>

<p>æ—¢ç„¶æˆ‘è¿™ä¹ˆçƒ­å¿ƒåˆ†äº«ï¼Œä¸å¦‚å¥½äººåšåˆ°åº•ï¼Œå¯¹ä¸å¯¹ï¼Ÿæˆ‘å°±è®¤è®¤çœŸçœŸåœ°å†™ä¸€ç¯‡æ–‡ç« ï¼Œç»™å°èœè§£æƒ‘ä¸€ä¸‹ã€‚</p>

<h3 id="01å·æ“ä½œç¬¦">01ã€â€œ+â€å·æ“ä½œç¬¦</h3>

<p>è¦è¯´å§¿åŠ¿ï¼Œâ€œ+â€å·æ“ä½œç¬¦å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥æœ€å¸¸ç”¨çš„ä¸€ç§äº†ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">chenmo</span> <span class="o">=</span> <span class="s">"æ²‰é»˜"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">wanger</span> <span class="o">=</span> <span class="s">"ç‹äºŒ"</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">chenmo</span> <span class="o">+</span> <span class="n">wanger</span><span class="o">);</span>
</code></pre></div></div>

<p>æˆ‘ä»¬æŠŠè¿™æ®µä»£ç ä½¿ç”¨ JAD åç¼–è¯‘ä¸€ä¸‹ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">chenmo</span> <span class="o">=</span> <span class="s">"\u6C89\u9ED8"</span><span class="o">;</span> <span class="c1">// æ²‰é»˜</span>
<span class="nc">String</span> <span class="n">wanger</span> <span class="o">=</span> <span class="s">"\u738B\u4E8C"</span><span class="o">;</span> <span class="c1">// ç‹äºŒ</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">chenmo</span><span class="o">))).</span><span class="na">append</span><span class="o">(</span><span class="n">wanger</span><span class="o">).</span><span class="na">toString</span><span class="o">());</span>
</code></pre></div></div>

<p>æˆ‘å»ï¼ŒåŸæ¥ç¼–è¯‘çš„æ—¶å€™æŠŠâ€œ+â€å·æ“ä½œç¬¦æ›¿æ¢æˆäº† StringBuilder çš„ append æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œ+â€å·æ“ä½œç¬¦åœ¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ—¶å€™åªæ˜¯ä¸€ç§å½¢å¼ä¸»ä¹‰ï¼Œè®©å¼€å‘è€…ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€ä¾¿ï¼Œä»£ç çœ‹èµ·æ¥æ¯”è¾ƒç®€æ´ï¼Œè¯»èµ·æ¥æ¯”è¾ƒé¡ºç•…ã€‚ç®—æ˜¯ Java çš„ä¸€ç§è¯­æ³•ç³–å§ã€‚</p>

<h3 id="02stringbuilder">02ã€StringBuilder</h3>

<p>é™¤å»â€œ+â€å·æ“ä½œç¬¦ï¼ŒStringBuilder çš„ append æ–¹æ³•å°±æ˜¯ç¬¬äºŒä¸ªå¸¸ç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥å§¿åŠ¿äº†ã€‚</p>

<p>å…ˆæ¥çœ‹ä¸€ä¸‹ StringBuilder ç±»çš„ append æ–¹æ³•çš„æºç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">StringBuilder</span> <span class="nf">append</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¿™ 3 è¡Œä»£ç æ²¡å•¥å¯çœ‹çš„ï¼Œå¯çœ‹çš„æ˜¯çˆ¶ç±» AbstractStringBuilder çš„ append æ–¹æ³•ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">AbstractStringBuilder</span> <span class="nf">append</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">str</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">return</span> <span class="nf">appendNull</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="n">ensureCapacityInternal</span><span class="o">(</span><span class="n">count</span> <span class="o">+</span> <span class="n">len</span><span class="o">);</span>
    <span class="n">str</span><span class="o">.</span><span class="na">getChars</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="n">len</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1ï¼‰åˆ¤æ–­æ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ nullï¼Œå¦‚æœæ˜¯ï¼Œå½“åšå­—ç¬¦ä¸²â€œnullâ€æ¥å¤„ç†ã€‚<code class="highlighter-rouge">appendNull</code> æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">AbstractStringBuilder</span> <span class="nf">appendNull</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
    <span class="n">ensureCapacityInternal</span><span class="o">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">4</span><span class="o">);</span>
    <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
    <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'n'</span><span class="o">;</span>
    <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'u'</span><span class="o">;</span>
    <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'l'</span><span class="o">;</span>
    <span class="n">value</span><span class="o">[</span><span class="n">c</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'l'</span><span class="o">;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>2ï¼‰æ‹¼æ¥åçš„å­—ç¬¦æ•°ç»„é•¿åº¦æ˜¯å¦è¶…è¿‡å½“å‰å€¼ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹å¹¶å¤åˆ¶ã€‚<code class="highlighter-rouge">ensureCapacityInternal</code> æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacityInternal</span><span class="o">(</span><span class="kt">int</span> <span class="n">minimumCapacity</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// overflow-conscious code</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">minimumCapacity</span> <span class="o">-</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">value</span><span class="o">,</span>
                <span class="n">newCapacity</span><span class="o">(</span><span class="n">minimumCapacity</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>3ï¼‰å°†æ‹¼æ¥çš„å­—ç¬¦ä¸² str å¤åˆ¶åˆ°ç›®æ ‡æ•°ç»„ value ä¸­ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="o">.</span><span class="na">getChars</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">count</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="03stringbuffer">03ã€StringBuffer</h3>

<p>å…ˆæœ‰ StringBuffer åæœ‰ StringBuilderï¼Œä¸¤è€…å°±åƒæ˜¯å­ªç”ŸåŒèƒèƒï¼Œè¯¥æœ‰çš„éƒ½æœ‰ï¼Œåªä¸è¿‡å¤§å“¥ StringBuffer å› ä¸ºå¤šå‘¼å¸ä¸¤å£æ–°é²œç©ºæ°”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">synchronized</span> <span class="nc">StringBuffer</span> <span class="nf">append</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">toStringCache</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>StringBuffer ç±»çš„ append æ–¹æ³•æ¯” StringBuilder å¤šäº†ä¸€ä¸ªå…³é”®å­— synchronizedï¼Œå¯æš‚æ—¶å¿½ç•¥ <code class="highlighter-rouge">toStringCache = null</code>ã€‚</p>

<p>synchronized æ˜¯ Java ä¸­çš„ä¸€ä¸ªéå¸¸å®¹æ˜“è„¸ç†Ÿçš„å…³é”®å­—ï¼Œæ˜¯ä¸€ç§åŒæ­¥é”ã€‚å®ƒä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>

<h3 id="04string-ç±»çš„-concat-æ–¹æ³•">04ã€String ç±»çš„ concat æ–¹æ³•</h3>

<p>å•å°±å§¿åŠ¿ä¸Šæ¥çœ‹ï¼ŒString ç±»çš„ concat æ–¹æ³•å°±å¥½åƒ StringBuilder ç±»çš„ appendã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">chenmo</span> <span class="o">=</span> <span class="s">"æ²‰é»˜"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">wanger</span> <span class="o">=</span> <span class="s">"ç‹äºŒ"</span><span class="o">;</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">chenmo</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">wanger</span><span class="o">));</span>
</code></pre></div></div>

<p>æ–‡ç« å†™åˆ°è¿™çš„æ—¶å€™ï¼Œæˆ‘çªç„¶äº§ç”Ÿäº†ä¸€ä¸ªå¥‡å¦™çš„æƒ³æ³•ã€‚å‡å¦‚æœ‰è¿™æ ·ä¸¤è¡Œä»£ç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chenmo</span> <span class="o">+=</span> <span class="n">wanger</span>
<span class="n">chenmo</span> <span class="o">=</span> <span class="n">chenmo</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">wanger</span><span class="o">)</span>
</code></pre></div></div>

<p>å®ƒä»¬ä¹‹é—´ç©¶ç«Ÿæœ‰å¤šå¤§çš„å·®åˆ«å‘¢ï¼Ÿ</p>

<p>ä¹‹å‰æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œ<code class="highlighter-rouge">chenmo += wanger</code> å®é™…ä¸Šç›¸å½“äº <code class="highlighter-rouge">(new StringBuilder(String.valueOf(chenmo))).append(wanger).toString()</code>ã€‚</p>

<p>è¦æ¢ç©¶â€œ+â€å·æ“ä½œç¬¦å’Œ <code class="highlighter-rouge">concat</code> ä¹‹é—´çš„å·®åˆ«ï¼Œå®é™…ä¸Šè¦çœ‹ append æ–¹æ³•å’Œ concat æ–¹æ³•ä¹‹é—´çš„å·®åˆ«ã€‚</p>

<p>append æ–¹æ³•çš„æºç ä¹‹å‰åˆ†æè¿‡äº†ã€‚æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ concat æ–¹æ³•çš„æºç å§ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">concat</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">otherLen</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">otherLen</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="o">[]</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">len</span> <span class="o">+</span> <span class="n">otherLen</span><span class="o">);</span>
    <span class="n">str</span><span class="o">.</span><span class="na">getChars</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1ï¼‰å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º 0ï¼Œé‚£ä¹ˆè¿”å›æ‹¼æ¥å‰çš„å­—ç¬¦ä¸²ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">otherLen</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>2ï¼‰å°†åŸå­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ç»„ value å¤åˆ¶åˆ°å˜é‡ buf æ•°ç»„ä¸­ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">buf</span><span class="o">[]</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">len</span> <span class="o">+</span> <span class="n">otherLen</span><span class="o">);</span>
</code></pre></div></div>

<p>3ï¼‰æŠŠæ‹¼æ¥çš„å­—ç¬¦ä¸² str å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„ buf ä¸­ï¼Œå¹¶è¿”å›æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="o">.</span><span class="na">getChars</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
<span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre></div></div>

<p>é€šè¿‡æºç åˆ†ææˆ‘ä»¬å¤§è‡´å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>

<p>1ï¼‰å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ nullï¼Œconcat æ—¶å€™å°±ä¼šæŠ›å‡º NullPointerExceptionï¼Œâ€œ+â€å·æ“ä½œç¬¦ä¼šå½“åšæ˜¯â€œnullâ€å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚</p>

<p>2ï¼‰å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ˆâ€â€œï¼‰ï¼Œé‚£ä¹ˆ concat çš„æ•ˆç‡è¦æ›´é«˜ä¸€ç‚¹ã€‚æ¯•ç«Ÿä¸éœ€è¦ <code class="highlighter-rouge">new  StringBuilder</code> å¯¹è±¡ã€‚</p>

<p>3ï¼‰å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²éå¸¸å¤šï¼Œconcat çš„æ•ˆç‡å°±ä¼šä¸‹é™ï¼Œå› ä¸ºåˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡è¶Šå¤šï¼Œå¼€é”€å°±è¶Šå¤§ã€‚</p>

<p><strong>æ³¨æ„äº†ï¼ï¼ï¼</strong></p>

<p>å¼±å¼±åœ°é—®ä¸€ä¸‹å•Šï¼Œè¿˜æœ‰åœ¨ç”¨ JSP çš„åŒå­¦å—ï¼ŸEL è¡¨è¾¾å¼ä¸­æ˜¯ä¸å…è®¸ä½¿ç”¨â€œ+â€æ“ä½œç¬¦æ¥æ‹¼æ¥å­—ç¬¦ä¸²çš„ï¼Œè¿™æ—¶å€™å°±åªèƒ½ç”¨ <code class="highlighter-rouge">concat</code> äº†ã€‚</p>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${chenmo.concat('-').concat(wanger)}
</code></pre></div></div>

<h3 id="05string-ç±»çš„-join-æ–¹æ³•">05ã€String ç±»çš„ join æ–¹æ³•</h3>

<p>JDK 1.8 æä¾›äº†ä¸€ç§æ–°çš„å­—ç¬¦ä¸²æ‹¼æ¥å§¿åŠ¿ï¼šString ç±»å¢åŠ äº†ä¸€ä¸ªé™æ€æ–¹æ³• joinã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">chenmo</span> <span class="o">=</span> <span class="s">"æ²‰é»˜"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">wanger</span> <span class="o">=</span> <span class="s">"ç‹äºŒ"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">cmower</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="n">chenmo</span><span class="o">,</span> <span class="n">wanger</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cmower</span><span class="o">);</span>
</code></pre></div></div>

<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼Œæ¯”å¦‚è¯´ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="s">"ç‹äºŒ"</span><span class="o">,</span> <span class="s">"å¤ªç‰¹ä¹ˆ"</span><span class="o">,</span> <span class="s">"æœ‰è¶£äº†"</span><span class="o">);</span>
</code></pre></div></div>

<p>è¾“å‡ºç»“æœä¸ºï¼šç‹äºŒ-å¤ªç‰¹ä¹ˆ-æœ‰è¶£äº†</p>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ join æ–¹æ³•çš„æºç ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">join</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">delimiter</span><span class="o">,</span> <span class="nc">CharSequence</span><span class="o">...</span> <span class="n">elements</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">delimiter</span><span class="o">);</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">elements</span><span class="o">);</span>
    <span class="c1">// Number of elements not likely worth Arrays.stream overhead.</span>
    <span class="nc">StringJoiner</span> <span class="n">joiner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringJoiner</span><span class="o">(</span><span class="n">delimiter</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">CharSequence</span> <span class="nl">cs:</span> <span class="n">elements</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">joiner</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">joiner</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å‘ç°äº†ä¸€ä¸ªæ–°ç±» StringJoinerï¼Œç±»åçœ‹èµ·æ¥å¾ˆ 6ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆé¡ºå£ã€‚StringJoiner æ˜¯ <code class="highlighter-rouge">java.util</code> åŒ…ä¸­çš„ä¸€ä¸ªç±»ï¼Œç”¨äºæ„é€ ä¸€ä¸ªç”±åˆ†éš”ç¬¦é‡æ–°è¿æ¥çš„å­—ç¬¦åºåˆ—ã€‚é™äºç¯‡å¹…ï¼Œæœ¬æ–‡å°±ä¸å†åšè¿‡å¤šä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚</p>

<h3 id="06stringutilsjoin">06ã€StringUtils.join</h3>

<p>å®æˆ˜é¡¹ç›®å½“ä¸­ï¼Œæˆ‘ä»¬å¤„ç†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°è¿™ä¸ªç±»â€”â€”<code class="highlighter-rouge">org.apache.commons.lang3.StringUtils</code>ï¼Œè¯¥ç±»çš„ join æ–¹æ³•æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¸€ç§æ–°å§¿åŠ¿ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">chenmo</span> <span class="o">=</span> <span class="s">"æ²‰é»˜"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">wanger</span> <span class="o">=</span> <span class="s">"ç‹äºŒ"</span><span class="o">;</span>

<span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">chenmo</span><span class="o">,</span> <span class="n">wanger</span><span class="o">);</span>
</code></pre></div></div>

<p>è¯¥æ–¹æ³•æ›´å–„äºæ‹¼æ¥æ•°ç»„ä¸­çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒ NullPointerExceptionã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>            <span class="o">=</span> <span class="kc">null</span>
<span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">([])</span>              <span class="o">=</span> <span class="s">""</span>
<span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">([</span><span class="kc">null</span><span class="o">])</span>          <span class="o">=</span> <span class="s">""</span>
<span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">([</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">])</span> <span class="o">=</span> <span class="s">"abc"</span>
<span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">([</span><span class="kc">null</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"a"</span><span class="o">])</span> <span class="o">=</span> <span class="s">"a"</span>
</code></pre></div></div>

<p>é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å†…éƒ¨ä½¿ç”¨çš„ä»ç„¶æ˜¯ StringBuilderã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">join</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">array</span><span class="o">,</span> <span class="nc">String</span> <span class="n">separator</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">startIndex</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">endIndex</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">array</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">separator</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">separator</span> <span class="o">=</span> <span class="no">EMPTY</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">final</span> <span class="nc">StringBuilder</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="n">noOfItems</span> <span class="o">*</span> <span class="mi">16</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">startIndex</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">endIndex</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">startIndex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">separator</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¤§å®¶è¯»åˆ°è¿™ï¼Œä¸çº¦è€ŒåŒä¼šæœ‰è¿™æ ·ä¸€ç§æ„Ÿè§‰ï¼šæˆ‘é ï¼ˆéŸ³è¦æ‹–é•¿ï¼‰ï¼Œæ²¡æƒ³åˆ°å•Šæ²¡æƒ³åˆ°ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥è¶³è¶³æœ‰ 6 ç§å§¿åŠ¿å•Šï¼Œæ™šä¸Šå›åˆ°å®¶ä¸€å®šè¦ä¸€ä¸€å°è¯•ä¸‹ã€‚</p>

<h3 id="07ç»™å°èœä¸€ä¸ªç­”å¤">07ã€ç»™å°èœä¸€ä¸ªç­”å¤</h3>

<p>æˆ‘ç›¸ä¿¡ï¼Œå°èœè¯»åˆ°æˆ‘è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä»–ä¸€å®šä¼šæ˜ç™½ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´ä¸å»ºè®®åœ¨ for å¾ªç¯ä¸­ä½¿ç”¨â€+â€å·æ“ä½œç¬¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥äº†ã€‚</p>

<p>æ¥çœ‹ä¸¤æ®µä»£ç ã€‚</p>

<p>ç¬¬ä¸€æ®µï¼Œfor å¾ªç¯ä¸­ä½¿ç”¨â€+â€å·æ“ä½œç¬¦ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">result</span> <span class="o">+=</span> <span class="s">"å…­å…­å…­"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ç¬¬äºŒæ®µï¼Œfor å¾ªç¯ä¸­ä½¿ç”¨ appendã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"å…­å…­å…­"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¿™ä¸¤æ®µä»£ç åˆ†åˆ«ä¼šè€—æ—¶å¤šé•¿æ—¶é—´å‘¢ï¼Ÿåœ¨æˆ‘çš„ iMac ä¸Šæµ‹è¯•å‡ºçš„ç»“æœæ˜¯ï¼š</p>

<p>1ï¼‰ç¬¬ä¸€æ®µä»£ç æ‰§è¡Œå®Œçš„æ—¶é—´ä¸º 6212 æ¯«ç§’</p>

<p>2ï¼‰ç¬¬äºŒæ®µä»£ç æ‰§è¡Œå®Œçš„æ—¶é—´ä¸º 1 æ¯«ç§’</p>

<p>å·®è·ä¹Ÿå¤ªç‰¹ä¹ˆå¤§äº†å§ï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>æˆ‘ç›¸ä¿¡æœ‰ä¸å°‘åŒå­¦å·²ç»æœ‰äº†è‡ªå·±çš„ç­”æ¡ˆï¼šç¬¬ä¸€æ®µçš„ for å¾ªç¯ä¸­åˆ›å»ºäº†å¤§é‡çš„ StringBuilder å¯¹è±¡ï¼Œè€Œç¬¬äºŒæ®µä»£ç è‡³å§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ª  StringBuilder å¯¹è±¡ã€‚</p>

<h3 id="08æœ€å">08ã€æœ€å</h3>

<p>è°¢è°¢å¤§å®¶çš„é˜…è¯»ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œå–œæ¬¢å°±éšæ‰‹ç‚¹ä¸ªèµğŸ‘ï¼Œè¿™å°†æ˜¯æˆ‘æœ€å¼ºçš„å†™ä½œåŠ¨åŠ›ã€‚å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰ç‚¹å¸®åŠ©ï¼Œè¿˜æŒºæœ‰è¶£ï¼Œå°±å…³æ³¨ä¸€ä¸‹æˆ‘çš„å…¬ä¼—å·ã€Œ<strong>æ²‰é»˜ç‹äºŒ</strong>ã€ï¼›å›å¤ã€Œ<strong>666</strong>ã€æ›´æœ‰ 500G é«˜è´¨é‡æ•™å­¦è§†é¢‘ç›¸é€ï¼ˆ<a href="https://mp.weixin.qq.com/s/GjkEyPW0vgIvuDLYQkBM0A">å·²åˆ†é—¨åˆ«ç±»</a>ï¼‰ã€‚</p>
:ET