# FastJson 

## å¼•è¨€

èº«ä¸ºåå°å¼€å‘ï¼Œé‚£æ—¥å¸¸è·Ÿå‰ç«¯äº¤äº’é‚£æ˜¯ä¸å¯é¿å…çš„ï¼Œé‚£æ—¶å¸¸å–å¼„ JSON æ•°æ®é‚£æ›´æ˜¯å¿…ä¸å¯ç¼ºçš„ï¼Œä»Šå¤©å°ç‰é‡åˆ°äº†ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼Œå½“ä»å‰å°æ¥æ”¶jsonå°è£…çš„listæ•°æ®ï¼Œåœ¨åå°æ¥æ”¶æ—¶æ§åˆ¶å°ä¸€ç›´æŠ¥é”™ï¼Œçœ‹çš„å°ç‰é‚£å¯æ˜¯å¤´çš®å‘éº»ï¼Œä¸çŸ¥å¦‚ä½•æ˜¯å¥½ï¼Œæ€ä¹ˆè§£å†³éƒ½æ²¡æ³•è§£å†³ï¼Œå°±æƒ³èµ·ä»–ç”œå“¥æˆ‘å•Šï¼Œç™¾äº‹é€šå•Šï¼Œé‚£å¯æ˜¯åä¸è™šä¼ ï¼Œç«‹é©¬å°±å¸®å¥¹æ‰¾åˆ°äº†ä¸»é¢˜æ‰€åœ¨ï¼Œå—–å—–å—–å°±è§£å†³äº†ï¼Œæ¥è®°å½•ä¸€ä¸‹ï¼Œä»¥å…å°ä¼™ä¼´ä»¬ä¸‹æ¬¡ç¢°åˆ°äº†ç»å°½è„‘æ±ï¼çœ‹ç”œå“¥ï¼Œå¤šæœ‰å…ˆè§ä¹‹æ˜ã€‚

è¯¦ç»†çš„é—®é¢˜ï¼Œä¸‹æ–‡ä¸€çœ‹ä¾¿çŸ¥ï¼

quick ğŸ˜‰


## é—®é¢˜


å…·ä½“é—®é¢˜æ˜¯è¿™æ ·çš„

> java.lang.ClassCastException: com.alibaba.fastjson.JSONObject cannot be cast to com.atian.bean.Student


ç¿»è¯‘è¿‡æ¥å°±æ˜¯ `com.alibaba.fastjson.JSONObjectæ— æ³•è½¬æ¢ä¸ºcom.tian.bean.Student` 

å…¶å®å°±æ˜¯åœ¨å°ç‰æ¥å—åˆ° å‰å°çš„json æ•°æ®è½¬ä¸º Student å¯¹è±¡çš„æ—¶å€™æ— æ³•è½¬æ¢ã€‚å½“æ—¶å°ç‰çš„ä»£ç æˆ‘å°±æˆ‘æ²¡è¦ï¼Œæˆ‘å†™ä¸€ä¸ªå°å°çš„ç¤ºä¾‹ï¼Œè®©å°ä¼™ä¼´ä»¬çœ‹ä¸‹æ¥å—åˆ°çš„æ˜¯ä»€ä¹ˆæ ·çš„ json æ•°æ®ã€‚

## ç¤ºä¾‹

å®ä½“ç±»  `Studentç±»`


```java
public class Student {

    private  Integer id; // ID

    List<String> classNums;  //ç­çº§ä¸ªæ•°

    //set getæ–¹æ³•
    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public List<String> getClassNums() {
        return classNums;
    }

    public void setClassNums(List<String> classNums) {
        this.classNums = classNums;
    }
    
}
```

æµ‹è¯•ç±» `Testç±»` åªæ˜¯ç®€å•æµ‹è¯•å†™ä¸€ä¸ªç®€å•çš„æ•°æ®



```java
public class Test {

    public static void main(String[] args) {

        List<String> classNums1 = new ArrayList<String>();
        classNums1.add("ä¸€ç­");
        classNums1.add("ä¸‰ç­");

        Student student1 = new Student();
        student1.setId(1);
        student1.setClassNums(classNums1);



        List<String> classNums2 = new ArrayList<String>();
        classNums2.add("å…­ç­");
        classNums2.add("å…«ç­");

        Student student2 = new Student();
        student2.setId(2);
        student2.setClassNums(classNums2);



        List<Student> studentList = new ArrayList<Student>();
        studentList.add(student1);
        studentList.add(student2);


        Map<String, Object> map = new HashMap<String, Object>();
        map.put("count", 2);
        map.put("studentList", studentList);
        String json = JSON.toJSONString(map, true);

        System.out.println(json);
    }
}
```

`JSON æ•°æ®`


```json
{
    "count":2,
    "studentList":[
        {
            "classNums":[
                "ä¸€ç­",
                "ä¸‰ç­"
            ],
            "id":1
        },
        {
            "classNums":[
                "å…­ç­",
                "å…«ç­"
            ],
            "id":2
        }
    ]
}
```

*å¯ä»¥æ˜ç¡®çš„çœ‹è§ï¼Œè¿™ä¸ª **json** å­—ç¬¦ä¸²å†…æœ‰ä¸€ä¸ªå†…ç½®çš„ **List***

è€Œå½“æ—¶å°ç‰æ˜¯è·å–åˆ°è¿™ä¸ª json æ•°æ®åæ˜¯ä¸‹æ–‡è¿™æ ·è§£æçš„ã€‚


```java

    HashMap hashMap = JSON.parseObject(json, HashMap.class);
    List<Student> students = (List<Student>) hashMap.get("studentList");
    for (Student student : students) { // Exception
        System.out.println(student.getId() + " ");
    }
  
```


æ‰§è¡Œè¿‡ç¨‹ä¸­å°±ä¼šå‡ºç°å‡ºç°java.lang.ClassCastException: com.alibaba.fastjson.JSONObject cannot be cast to com.atian.bean.Student æ­¤å¼‚å¸¸:

é”™è¯¯ä¿¡æ¯

```java
Exception in thread "main" java.lang.ClassCastException: com.alibaba.fastjson.JSONObject cannot be cast to com.atian.bean.Student
	    at com.atian.bean.Test.main(Test.java:55)
```


## è§£å†³åŠæ³•

ç»è¿‡æˆ‘ä½¿ç”¨ **debug**å‘ç°ï¼Œå…¶å®é‚£æ˜¯ä¸€ä¸ª JsonObject çœ‹ä¸‹å›¾å¯ä¸€æ¢ç©¶ç«Ÿã€‚


æ‰€ä»¥è¯´ä½¿ç”¨å°ç‰è¿™ç§è§£ææ–¹å¼æ˜¯æ— æ³•è§£æçš„ï¼Œåº”ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•è§£æ jsonå†…å« *List*

### æ­£ç¡®æ–¹æ³•


```java
    //æ­¤è¡Œä»£ç ä¸ºæ­£ç¡®è§£ææ–¹æ³•ï¼Œä»…æ­¤ä¸€è¡Œä¾¿å¯ä»¥
    List<Student> students = JSON.parseArray(JSON.parseObject(json).getString("studentList"), Student.class);

```

æ­£ç¡®çš„æ–¹æ³•è§£æéå†Listé›†åˆçš„ä»£ç åŠç»“æœ

##### ä»£ç 

```java
    //ä»¥ä¸‹ä¸ºéå†æ¼”ç¤ºè·å–åˆ°çš„Listæ•°æ®ï¼Œæ— é¡»åœ¨æ„
    for (Student student : students) { // Exception
        System.out.println(" ID ä¸º ï¼š"  + student.getId() );
        System.out.println(" ç­çº§num ä¸º ï¼š"  + student.getClassNums() );
    }
```

##### ç»“æœ

```java
 ID ä¸º ï¼š1
 ç­çº§num ä¸º ï¼š[ä¸€ç­, ä¸‰ç­]
 ID ä¸º ï¼š2
 ç­çº§num ä¸º ï¼š[å…­ç­, å…«ç­]
```

## æ€»ç»“

å¬é—»é˜¿é‡Œçš„ **FastJson** ä½¿ç”¨ç‰¹åˆ«çš„ç®—æ³•ï¼Œé€Ÿåº¦éå¸¸å¿«ï¼Œç”šè‡³å¿«è¿‡ *Google* çš„ protobufï¼Œæ‰€ä»¥é€‰æ‹©ä½¿ç”¨ FastJson æ¥åš Json çš„å¤„ç†ï¼Œäººå®¶è™½å¼ºï¼Œå¾ˆå¿«ï¼Œä½†æˆ‘ä»¬è‡ªå·±ä½¿ç”¨çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯éš¾å…ä¼šé‡åˆ°ä¸€äº›æœªçŸ¥çš„é—®é¢˜ã€bug ï¼Œè«è¦ç°å¿ƒï¼ŒåšæŒä¸‹å»ï¼Œè§£å†³é—®é¢˜ï¼Œä½ å°±ä¼šå‘ç°ä¸äºæ˜¯çœŸçš„å¿«ï¼Œåˆ«æ€•ï¼Œä½ è¿˜æœ‰æˆ‘ï¼Œæœ‰é—®é¢˜æ‰¾ç”œå“¥ï¼Œå¥¥åŠ›ç»™ï¼Œè¿˜æœ‰æ›´å¤šçš„ç§˜å¯†ç­‰ç€ä½ æ¥æ¢ç´¢ï¼



åˆ†äº«å—¨èµ·æ¥ï¼Œåœ¨çœ‹ç‚¹èµ·æ¥ï¼Œç¾å¾·ä¼ èµ·æ¥ï¼Œç‚¹ä¸ªæ˜Ÿæ ‡ä»æ­¤æ¢ç´¢ä¹‹è·¯ä¸è¿·èŒ«ï¼


*PS* ï¼šè‹¥æœ‰äº›å°ä¼™ä¼´ä»¬æ— æ³•ä½¿ç”¨é˜¿é‡Œçš„FastJsonï¼Œå¯åœ¨ **pom.xml** å¯¼å…¥ä¾èµ–ï¼š


```xml
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>fastjson</artifactId>
        <version>1.2.62</version>
    </dependency>
```





